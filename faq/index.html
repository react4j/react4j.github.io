<!DOCTYPE html>

<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta name="generator" content="Jekyll v3.3.0">

		<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Merriweather:400,400italic,700,700italic|Open+Sans:400,400italic,600,600italic,700,700italic|Inconsolata:400,700">
		<link rel="stylesheet" href="/css/main.css">

		<title>Frequently Asked Questions</title>

		<link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
		<link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
		<link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
		<link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
		<link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
		<link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
		<link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
		<link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
		<link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
		<link rel="icon" type="image/png" sizes="192x192"  href="/android-icon-192x192.png">
		<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
		<link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png">
		<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
		<link rel="manifest" href="/manifest.json">
		<meta name="msapplication-TileColor" content="#ffffff">
		<meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
		<meta name="theme-color" content="#ffffff">
	</head>

	<body>
		<header>
			<h1>
				<img src="/images/logo.svg" alt="React4j" width="45">
				React4J User Manual
				<button type="button" class="open-nav" id="open-nav"></button>
			</h1>

			<form action="/search/" method="get">
				<input type="text" name="q" id="search-input" placeholder="Search" autofocus>
				<input type="submit" value="Search" style="display: none;">
			</form>

			<nav >
				<ul>
					<li class="nav-item top-level ">
						
						<a href="/">Introduction</a>
					</li>
				</ul>

				<ul>
					
					
						<li class="nav-item top-level current">
							
							<a href="/faq/">General</a>
							<ul>
								
									<li class="nav-item current"><a href="/faq/">Frequently Asked Questions</a></li>
								
									<li class="nav-item "><a href="/compared_to_react/">Compared to React</a></li>
								
									<li class="nav-item "><a href="/arez/">Arez</a></li>
								
									<li class="nav-item "><a href="/dependency_injection/">Dependency Injection</a></li>
								
							</ul>
						</li>
					
				</ul>
				<ul>
					<li class="nav-item top-level">
						
						<a href="/api/index.html" target="_blank">Javadocs</a>
					</li>
				</ul>
				<ul>
					<li class="nav-item top-level ">
						
						<a href="/changelog/">Change Log</a>
					</li>
				</ul>
			</nav>
		</header>

		<section class="main">
			<div class="page-header">
				<h2>General</h2>
				<h3>Frequently Asked Questions</h3>
			</div>
			<article class="content">
				<ul class="section-nav">
<li class="toc-entry toc-h3"><a href="#design">Design</a>
<ul>
<li class="toc-entry toc-h4"><a href="#will-react4j-work-on-future-versions-of-gwt">Will React4j work on future versions of GWT?</a></li>
<li class="toc-entry toc-h4"><a href="#where-is-the-equivalent-of-reacts-stateless-function-components">Where is the equivalent of React’s stateless function components?</a></li>
<li class="toc-entry toc-h4"><a href="#why-is-there-both-nativecomponent-and-component-classes">Why is there both NativeComponent and Component classes?</a></li>
<li class="toc-entry toc-h4"><a href="#why-does-react4j-manually-export-types-to-javascript">Why does React4j manually export types to Javascript?</a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#arez-integration">Arez Integration</a>
<ul>
<li class="toc-entry toc-h4"><a href="#which-components-should-extend-reactarezcomponent">Which components should extend ReactArezComponent?</a></li>
<li class="toc-entry toc-h4"><a href="#should-components-implement-custom-shouldcomponentupdate-method">Should components implement custom shouldComponentUpdate() method?</a></li>
<li class="toc-entry toc-h4"><a href="#why-is-there-an-arez-key-in-component-state">Why is there an ‘arez’ key in component state?</a></li>
<li class="toc-entry toc-h4"><a href="#why-cant-render-methods-update-observable-state">Why can’t render methods update observable state?</a></li>
</ul>
</li>
</ul><h3 id="design">
<a id="design" class="anchor" href="#design" aria-hidden="true"><span class="octicon octicon-link"></span></a>Design</h3>

<h4 id="will-react4j-work-on-future-versions-of-gwt">
<a id="will-react4j-work-on-future-versions-of-gwt" class="anchor" href="#will-react4j-work-on-future-versions-of-gwt" aria-hidden="true"><span class="octicon octicon-link"></span></a>Will React4j work on future versions of GWT?</h4>

<p>React4j was designed from the ground up to be as forward compatible as possible with future
versions of GWT. Google is currently working on J2CL (Java 2 Closure Compiler) which is a
modern take on a java-to-javascript transpiler that emits Closure Compiler annotated javascript
as output. This promises a modern take on the story with an even more advanced optimizing
compiler working in the background.</p>

<p>React4j aims to target J2CL as early as possible while maintaining compatibility with GWT2.x for
as long as possible and likely targeting GWT 3.x into the future. The library does this by using
jsinterop and <a href="https://github.com/google/elemental2">elemental2</a> to interact with the browser.</p>

<h4 id="where-is-the-equivalent-of-reacts-stateless-function-components">
<a id="where-is-the-equivalent-of-reacts-stateless-function-components" class="anchor" href="#where-is-the-equivalent-of-reacts-stateless-function-components" aria-hidden="true"><span class="octicon octicon-link"></span></a>Where is the equivalent of React’s stateless function components?</h4>

<p>The project originally supported stateless functional components defined by an interface that had
a single render method. You could define the rendering of the method using a simple lambda method
that accepted a <code class="highlighter-rouge">props</code> object. This resulted in code that looked like:</p>

<div class="language-java highlighter-rouge">
<pre class="highlight"><code><span class="kd">class</span> <span class="nc">MyComponent</span> <span class="o">{</span>
  <span class="nd">@JsType</span><span class="o">(</span><span class="n">isNative</span> <span class="o">=</span> <span class="kc">true</span><span class="o">,</span> <span class="n">namespace</span> <span class="o">=</span> <span class="n">JsPackage</span><span class="o">.</span><span class="na">GLOBAL</span><span class="o">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s">"Object"</span><span class="o">)</span>
  <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Props</span> <span class="kd">extends</span> <span class="n">BaseProps</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">param</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@ReactComponent</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">StatelessComponent</span><span class="o">&lt;</span><span class="n">Props</span><span class="o">&gt;</span> <span class="n">COMPONENT</span> <span class="o">=</span> <span class="o">(</span><span class="n">props</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nf">span</span><span class="o">(</span><span class="k">new</span> <span class="n">HtmlProps</span><span class="o">().</span><span class="na">className</span><span class="o">(</span><span class="s">"myclass"</span><span class="o">),</span> <span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span> <span class="n">props</span><span class="o">.</span><span class="na">param</span> <span class="o">));</span>
  <span class="o">};</span>
<span class="o">}</span>
</code></pre>
</div>

<p>Contrast this with code that uses normal components:</p>

<div class="language-java highlighter-rouge">
<pre class="highlight"><code><span class="nd">@ReactComponent</span>
<span class="kd">class</span> <span class="nc">MyComponent</span> <span class="kd">extends</span> <span class="n">Component</span><span class="o">&lt;</span><span class="n">MyComponent</span><span class="o">.</span><span class="na">Props</span><span class="o">,</span> <span class="n">BaseState</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="nd">@JsType</span><span class="o">(</span><span class="n">isNative</span> <span class="o">=</span> <span class="kc">true</span><span class="o">,</span> <span class="n">namespace</span> <span class="o">=</span> <span class="n">JsPackage</span><span class="o">.</span><span class="na">GLOBAL</span><span class="o">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s">"Object"</span><span class="o">)</span>
  <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Props</span> <span class="kd">extends</span> <span class="n">BaseProps</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">param</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="n">ReactElement</span><span class="o">&lt;?,</span> <span class="o">?&gt;</span> <span class="n">render</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nf">span</span><span class="o">(</span><span class="k">new</span> <span class="n">HtmlProps</span><span class="o">().</span><span class="na">className</span><span class="o">(</span><span class="s">"myclass"</span><span class="o">),</span> <span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span> <span class="n">props</span><span class="o">.</span><span class="na">param</span> <span class="o">));</span>
  <span class="o">};</span>
<span class="o">}</span>
</code></pre>
</div>

<p>In java, the <code class="highlighter-rouge">StatelessComponent</code> approach seemed to offer few advantages. The two approaches were
roughly equal in the amount of ceremony required and identical from a performance standpoint. However the
<code class="highlighter-rouge">StatelessComponent</code> approach required more work if you needed to refactor the components later to add state,
or use the lifecycle callback methods.</p>

<p>So we removed <code class="highlighter-rouge">StatelessComponent</code> and simplified our application, the library and supporting tools. (The
annotation processor is significantly simpler as a result of this change.)</p>

<p>The react team has promised that at some point in the future, stateless functional components will have a
better performance profile due to lower memory usage and low-level optimization opportunities within
the react runtime. When this eventuates, it will be reasonably easy for React4j to take advantage of these
enhancements with no changes to the way components are written. The annotation processor already analyzes
the component to determine if the component uses state or if any lifecycle methods are declared. If neither
of these conditions is true, React4j could transparently expose the component as a stateless functional
component and take advantage of the potential performance enhancements.</p>

<p>Actually it turns out that functional components should be slightly faster in React 16 as there’s no
instance created to wrap them unlike in React 15. However this seems to be obscured by the slight overhead
of React4j but when/if the performance becomes more discernible, expect React4j to begin supporting stateless
functional components.</p>

<p>It should be noted that a month or two after we had made this decision the article
<a href="https://medium.freecodecamp.org/7-reasons-to-outlaw-reacts-functional-components-ff5b5ae09b7c">“7 Reasons to Outlaw React’s Functional Components”</a>
was published and a similar sentiment arose in the Javascript community.</p>

<h4 id="why-is-there-both-nativecomponent-and-component-classes">
<a id="why-is-there-both-nativecomponent-and-component-classes" class="anchor" href="#why-is-there-both-nativecomponent-and-component-classes" aria-hidden="true"><span class="octicon octicon-link"></span></a>Why is there both NativeComponent and Component classes?</h4>

<p>The project initially required that React4j components all extend the equivalent of the <code class="highlighter-rouge">NativeComponent</code>
and thus React4j components had to be exported as javascript objects using the <code class="highlighter-rouge">@JsType(isNative = false)</code> annotation.
This model required that the developer was very aware of the constraints of developing classes that would be
exported as javascript. This often resulted in lots of code being annotated with either <code class="highlighter-rouge">@JsIgnore</code> or
<code class="highlighter-rouge">@SuppressWarnings("unusable-by-js")</code> to avoid warnings being generated by the GWT compiler. The developer
experience was less than optimal.</p>

<p>Building a parallel component hierarchy allowed us to remove the boilerplate and constraints required to export
a native object to javascript. It also made it possible to add additional validation to verify that the application
code interacts with the native react runtime correctly.</p>

<h4 id="why-does-react4j-manually-export-types-to-javascript">
<a id="why-does-react4j-manually-export-types-to-javascript" class="anchor" href="#why-does-react4j-manually-export-types-to-javascript" aria-hidden="true"><span class="octicon octicon-link"></span></a>Why does React4j manually export types to Javascript?</h4>

<p>GWT has <code class="highlighter-rouge">@JsType(isNative = false)</code> and yet the framework does not use it. The main reason is that this
is not a use case that the J2CL/GWT compiler team want to support. <code class="highlighter-rouge">@JsType(isNative = false)</code> is intended to
be used to export classes for consumption by other javascript projects and requires that the consumers of
the library pass command line arguments to the compiler to control which parts of the framework is exported
to native javascript. React4j needs to export components in a particular shape so that the native javascript
library knows how to use the components. Turning off exports or excluding the wrong elements would result in
a broken library. As the J2CL/GWT team have taken a philosophical stance against controlling the
export of code inside <code class="highlighter-rouge">.gwt.xml</code>, there is a strong possibility that users of React4j could end up with broken
applications through incorrect build configuration.</p>

<p>To avoid this scenario impacting users of React4j, the library manually exports the components to native code.
Users of the library are free to use <code class="highlighter-rouge">@JsType(isNative = false)</code> and control it through the normal means but
this should not impact the correctness of the React4j &lt;=&gt; react integration. The amount of code that is manually
exported to Javascript has been minimized and is mostly restricted to the equivalent of static class properties
in ES6 and a constructor function.</p>

<h3 id="arez-integration">
<a id="arez-integration" class="anchor" href="#arez-integration" aria-hidden="true"><span class="octicon octicon-link"></span></a>Arez Integration</h3>

<h4 id="which-components-should-extend-reactarezcomponent">
<a id="which-components-should-extend-reactarezcomponent" class="anchor" href="#which-components-should-extend-reactarezcomponent" aria-hidden="true"><span class="octicon octicon-link"></span></a>Which components should extend ReactArezComponent?</h4>

<p>Any component that uses arez observable properties or computed properties within the <code class="highlighter-rouge">render()</code> method should
extend <code class="highlighter-rouge">ReactArezComponent</code>. This ensures that the component is scheduled for re-render when the data changes.</p>

<p>Sometimes you want to share a generic component between projects and rather than passing arez reactive components
into the component and making the generic component extend <code class="highlighter-rouge">ReactArezComponent</code> you can instead pass in simple
values as props into the generic component. The container component will still extend <code class="highlighter-rouge">ReactArezComponent</code> and
will be re-rendered when the observable and/or computed properties change and will pass new props to the generic
component forcing it to re-render. This is slightly less optimized but allows you to create generic components
like <code class="highlighter-rouge">ToggleButton</code> rather than domain specific <code class="highlighter-rouge">TodoToggleAllButton</code>.</p>

<h4 id="should-components-implement-custom-shouldcomponentupdate-method">
<a id="should-components-implement-custom-shouldcomponentupdate-method" class="anchor" href="#should-components-implement-custom-shouldcomponentupdate-method" aria-hidden="true"><span class="octicon octicon-link"></span></a>Should components implement custom shouldComponentUpdate() method?</h4>

<p>The <code class="highlighter-rouge">ReactArezComponent</code> class already implements an optimized <code class="highlighter-rouge">shouldComponentUpdate()</code> that will only trigger
a re-render if the dependent observable/computed properties have changed, the state has changed or a shallow
comparison of props produces no differences. In most scenarios, it is not necessary to override
<code class="highlighter-rouge">shouldComponentUpdate()</code> but if you <strong>need</strong> to override the method <code class="highlighter-rouge">shouldComponentUpdate()</code> then it is possible
however you should return true if <code class="highlighter-rouge">ReactArezComponent.hasRenderDepsChanged()</code> returns true to ensure integration
works as expected.</p>

<h4 id="why-is-there-an-arez-key-in-component-state">
<a id="why-is-there-an-arez-key-in-component-state" class="anchor" href="#why-is-there-an-arez-key-in-component-state" aria-hidden="true"><span class="octicon octicon-link"></span></a>Why is there an ‘arez’ key in component state?</h4>

<p>Components that extend <code class="highlighter-rouge">ReactArezComponent</code> will automatically have a key <code class="highlighter-rouge">arez</code> set if the configuration
property <code class="highlighter-rouge">react4j.arez.store_arez_data_as_state</code> is set to <code class="highlighter-rouge">true</code>. This can be done manually or by inheriting
from the GWT module <code class="highlighter-rouge">react4j.arez.ReactArezDev</code>. The purpose of this is to give the developer a quick visual
indication of the direct arez dependencies of the <code class="highlighter-rouge">ReactArezComponent</code>. It began as a stop-gap measure until
a “Arez DevTools” tool was implemented but remained as people found it useful. This should NOT be enabled in
production code as updating the dependency information can cause a re-render of the component even though there
is no actual changes to the content rendered in the browser.</p>

<h4 id="why-cant-render-methods-update-observable-state">
<a id="why-cant-render-methods-update-observable-state" class="anchor" href="#why-cant-render-methods-update-observable-state" aria-hidden="true"><span class="octicon octicon-link"></span></a>Why can’t render methods update observable state?</h4>

<p>Arez has the concept of read-write and read-only transactions and observable state should only be modified in
read-write transactions. This is enforced in development mode and assertion failures will occur if you attempt
to modify observable state in a read-only transaction. The <code class="highlighter-rouge">render()</code> method is deliberately wrapped in a read-only
transaction.</p>

<p>The main reason for this is to disallow a render triggering further renders and to stop potentially long render
times as other observers react to changes in observable state. The underlying react library also considers this
pattern a very bad idea conceptually and performance-wise and likewise blocks calling <code class="highlighter-rouge">setState()</code> from within
the render method.</p>

			</article>
		</section>

		<script>
			document.getElementById("open-nav").addEventListener("click", function () {
				document.body.classList.toggle("nav-open");
			});
		</script>
	</body>
</html>
