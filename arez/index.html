<!DOCTYPE html>

<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta name="generator" content="Jekyll v3.3.0">

		<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Merriweather:400,400italic,700,700italic|Open+Sans:400,400italic,600,600italic,700,700italic|Inconsolata:400,700">
		<link rel="stylesheet" href="/css/main.css">

		<title>Arez</title>

		<link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
		<link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
		<link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
		<link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
		<link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
		<link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
		<link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
		<link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
		<link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
		<link rel="icon" type="image/png" sizes="192x192"  href="/android-icon-192x192.png">
		<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
		<link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png">
		<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
		<link rel="manifest" href="/manifest.json">
		<meta name="msapplication-TileColor" content="#ffffff">
		<meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
		<meta name="theme-color" content="#ffffff">
	</head>

	<body>
		<header>
			<h1>
				<img src="/images/logo.svg" alt="React4j" width="45">
				React4J User Manual
				<button type="button" class="open-nav" id="open-nav"></button>
			</h1>

			<form action="/search/" method="get">
				<input type="text" name="q" id="search-input" placeholder="Search" autofocus>
				<input type="submit" value="Search" style="display: none;">
			</form>

			<nav >
				<ul>
					<li class="nav-item top-level ">
						
						<a href="/">Introduction</a>
					</li>
				</ul>

				<ul>
					
					
						<li class="nav-item top-level current">
							
							<a href="/faq/">General</a>
							<ul>
								
									<li class="nav-item "><a href="/faq/">Frequently Asked Questions</a></li>
								
									<li class="nav-item "><a href="/compared_to_react/">Compared to React</a></li>
								
									<li class="nav-item current"><a href="/arez/">Arez</a></li>
								
									<li class="nav-item "><a href="/dependency_injection/">Dependency Injection</a></li>
								
							</ul>
						</li>
					
				</ul>
				<ul>
					<li class="nav-item top-level">
						
						<a href="/api/index.html" target="_blank">Javadocs</a>
					</li>
				</ul>
				<ul>
					<li class="nav-item top-level ">
						
						<a href="/changelog/">Change Log</a>
					</li>
				</ul>
			</nav>
		</header>

		<section class="main">
			<div class="page-header">
				<h2>General</h2>
				<h3>Arez</h3>
			</div>
			<article class="content">
				<p>The combination of <a href="https://arez.github.io">Arez</a> and React4j creates a powerful toolkit. Arez manages
the application state and React4j transforms the application state into a view. The React4jArez library provides
the mechanisms for synchronizing the application state with the view. Both React4j and Arez are based on functional
principles and trade higher memory usage for faster execution speed.</p>

<p>React reduces the number of expensive DOM updates through the use of a virtual DOM. The application builds a future
view and this is reconciled against the current view and any differences are applied to the DOM.</p>

<p>Arez is built around a data flow graph where state modifications flow through the graph updating nodes only as
required. Data nodes are always up to date and perform the minimum amount of work based on the graph definition.</p>

<p>The React4jArez library bridges the two systems, triggering view updates when the state updates. Changes to observable
data that a <code class="highlighter-rouge">ReactArezComponent</code> component uses during rendering will schedule the component for re-rendering. The
developer controls the scope of the re-render by controlling the size of the component.</p>

<h2 id="getting-started">Getting Started</h2>

<p>The simplest approach to defining an Arez enabled component is simply to extend
<a href="/api/react4j/arez/ReactArezComponent.html">ReactArezComponent</a>. This will result in the <code class="highlighter-rouge">render()</code> method being invoked
within the scope of a read-only, tracking (Arez) transaction. Changes to the observable state accessed within the
scope of the <code class="highlighter-rouge">render()</code> will schedule the component for re-rendering.</p>

<p>As most event handlers within a <code class="highlighter-rouge">ReactArezComponent</code> component will either access or mutate observable state, the
helper methods generated as a result of annotating a method with <code class="highlighter-rouge">@EventHandler</code> will default to being annotated with
arez’s <code class="highlighter-rouge">@Action</code> annotation. If you do not wish an event handler to be run as an action you can annotate the event
handler with the <a href="/api/react4j/arez/NoAutoAction.html">@NoAutoAction</a> annotation. This can be useful if you want to
explicitly control the actions parameters (i.e. to make the action run in a read-only transaction) or you want to
optimize a frequently called event handler by removing the overhead associated with annotating a method with
<code class="highlighter-rouge">@Action</code>.</p>

<p>Below is a <code class="highlighter-rouge">Footer</code> component extracted from a <a href="http://todomvc.com/">TodoMVC</a> implementation. It accesses the
observable state <code class="highlighter-rouge">AppData.model.totalCount()</code>, <code class="highlighter-rouge">AppData.viewService.getFilterMode()</code> and
<code class="highlighter-rouge">AppData.model.completedCount()</code> and will re-render each time any of these values change.</p>

<div class="example">

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@ReactComponent</span>
<span class="kd">class</span> <span class="nc">Footer</span>
  <span class="kd">extends</span> <span class="n">ReactArezComponent</span><span class="o">&lt;</span><span class="n">BaseProps</span><span class="o">,</span> <span class="n">BaseContext</span><span class="o">&gt;</span>
<span class="o">{</span>
  <span class="nd">@EventHandler</span><span class="o">(</span> <span class="n">MouseEventHandler</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
  <span class="kt">void</span> <span class="nf">handleClearCompleted</span><span class="o">()</span>
  <span class="o">{</span>
    <span class="n">AppData</span><span class="o">.</span><span class="na">service</span><span class="o">.</span><span class="na">clearCompleted</span><span class="o">();</span>
  <span class="o">}</span>

  <span class="nd">@Nullable</span>
  <span class="nd">@Override</span>
  <span class="kd">protected</span> <span class="n">ReactNode</span> <span class="nf">render</span><span class="o">()</span>
  <span class="o">{</span>
    <span class="kd">final</span> <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="n">AppData</span><span class="o">.</span><span class="na">model</span><span class="o">.</span><span class="na">totalCount</span><span class="o">();</span>
    <span class="kd">final</span> <span class="n">String</span> <span class="n">activeTodoWord</span> <span class="o">=</span> <span class="s">"item"</span> <span class="o">+</span> <span class="o">(</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">?</span> <span class="s">""</span> <span class="o">:</span> <span class="s">"s"</span> <span class="o">);</span>
    <span class="kd">final</span> <span class="n">FilterMode</span> <span class="n">filterMode</span> <span class="o">=</span> <span class="n">AppData</span><span class="o">.</span><span class="na">viewService</span><span class="o">.</span><span class="na">getFilterMode</span><span class="o">();</span>
    <span class="k">return</span>
      <span class="nf">footer</span><span class="o">(</span> <span class="k">new</span> <span class="n">HtmlProps</span><span class="o">().</span><span class="na">className</span><span class="o">(</span> <span class="s">"footer"</span> <span class="o">),</span>
              <span class="n">span</span><span class="o">(</span> <span class="k">new</span> <span class="n">HtmlProps</span><span class="o">().</span><span class="na">className</span><span class="o">(</span> <span class="s">"todo-count"</span> <span class="o">),</span>
                    <span class="n">strong</span><span class="o">(</span> <span class="n">Integer</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span> <span class="n">count</span> <span class="o">)</span> <span class="o">),</span>
                    <span class="n">text</span><span class="o">(</span> <span class="s">" "</span> <span class="o">+</span> <span class="n">activeTodoWord</span> <span class="o">+</span> <span class="s">" left"</span> <span class="o">)</span>
              <span class="o">),</span>
              <span class="n">ul</span><span class="o">(</span> <span class="k">new</span> <span class="n">HtmlProps</span><span class="o">().</span><span class="na">className</span><span class="o">(</span> <span class="s">"filters"</span> <span class="o">),</span>
                  <span class="n">li</span><span class="o">(</span> <span class="n">a</span><span class="o">(</span> <span class="k">new</span> <span class="n">AnchorProps</span><span class="o">()</span>
                           <span class="o">.</span><span class="na">className</span><span class="o">(</span> <span class="n">FilterMode</span><span class="o">.</span><span class="na">ALL</span> <span class="o">==</span> <span class="n">filterMode</span> <span class="o">?</span> <span class="s">"selected"</span> <span class="o">:</span> <span class="s">""</span> <span class="o">)</span>
                           <span class="o">.</span><span class="na">href</span><span class="o">(</span> <span class="s">"#"</span> <span class="o">),</span> <span class="s">"All"</span> <span class="o">)</span>
                  <span class="o">),</span>
                  <span class="n">li</span><span class="o">(</span> <span class="n">a</span><span class="o">(</span> <span class="k">new</span> <span class="n">AnchorProps</span><span class="o">()</span>
                           <span class="o">.</span><span class="na">className</span><span class="o">(</span> <span class="n">FilterMode</span><span class="o">.</span><span class="na">ACTIVE</span> <span class="o">==</span> <span class="n">filterMode</span> <span class="o">?</span> <span class="s">"selected"</span> <span class="o">:</span> <span class="s">""</span> <span class="o">)</span>
                           <span class="o">.</span><span class="na">href</span><span class="o">(</span> <span class="s">"#active"</span> <span class="o">),</span> <span class="s">"Active"</span> <span class="o">)</span>
                  <span class="o">),</span>
                  <span class="n">li</span><span class="o">(</span> <span class="n">a</span><span class="o">(</span> <span class="k">new</span> <span class="n">AnchorProps</span><span class="o">()</span>
                           <span class="o">.</span><span class="na">className</span><span class="o">(</span> <span class="n">FilterMode</span><span class="o">.</span><span class="na">COMPLETED</span> <span class="o">==</span> <span class="n">filterMode</span> <span class="o">?</span> <span class="s">"selected"</span> <span class="o">:</span> <span class="s">""</span> <span class="o">)</span>
                           <span class="o">.</span><span class="na">href</span><span class="o">(</span> <span class="s">"#completed"</span> <span class="o">),</span> <span class="s">"Completed"</span> <span class="o">)</span>
                  <span class="o">)</span>
              <span class="o">),</span>
              <span class="n">AppData</span><span class="o">.</span><span class="na">model</span><span class="o">.</span><span class="na">completedCount</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">?</span>
              <span class="n">button</span><span class="o">(</span> <span class="k">new</span> <span class="n">BtnProps</span><span class="o">().</span><span class="na">className</span><span class="o">(</span> <span class="s">"clear-completed"</span> <span class="o">).</span><span class="na">onClick</span><span class="o">(</span> <span class="n">_handleClearCompleted</span><span class="o">(</span> <span class="k">this</span> <span class="o">)</span> <span class="o">),</span>
                      <span class="s">"Clear Completed"</span> <span class="o">)</span> <span class="o">:</span>
              <span class="kc">null</span>
      <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

</div>

<hr />

<h2 id="optimizing-the-component">Optimizing the component</h2>

<p>However this is not the most efficient component. There are several scenarios where the component wil re-render
but produce identical output. This is inefficient as React4j will take time to re-render the component to the
virtual DOM and then additional time to reconcile the virtual DOM against the actual DOM.</p>

<p>Whether this inefficiency has any impact on the user experience will depend upon the application. In particular
it will depend on how frequently the observable data changes, what other parts of the view are updated when the
same observable data changes and how dynamic and complex the remainder of the view is. It is often the case that
re-rendering the entire component is perfectly fine and will have no impact on the users experience, as in the
case with a <a href="http://todomvc.com/">TodoMVC</a> implementation.</p>

<p>However let’s assume that this component needs to be optimized and walk through the steps that would be required to
optimize the component to reduce the scope and frequency of re-renders.</p>

<h3 id="use-computed">Use @Computed</h3>

<p>If you turn on “Highlight Updates” in React’s DevTools you will notice that the whole component re-renders any time
a Todo is toggled from “complete” to “not complete” or vice-versa. However the html output only changes if the
number of completed Todos changes from 0 to not zero or from not zero to zero.</p>

<p>To eliminate these unnecessary renders, the simplest approach is to extract the expression
<code class="highlighter-rouge">AppData.model.completedCount() &gt; 0</code> into a separate <code class="highlighter-rouge">@Computed</code> method. The <code class="highlighter-rouge">render()</code> method will only be scheduled
to render if the value returned from the <code class="highlighter-rouge">@Computed</code> method changes.</p>

<p>This method will look like:</p>

<div class="example">

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@Computed</span>
<span class="kt">boolean</span> <span class="nf">hasCompletedItems</span><span class="o">()</span>
<span class="o">{</span>
  <span class="k">return</span> <span class="n">AppData</span><span class="o">.</span><span class="na">model</span><span class="o">.</span><span class="na">completedCount</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">;</span>
<span class="o">}</span></code></pre></figure>

</div>

<p>Using computed properties is one of the easiest and least intrusive mechanisms for optimizing components.</p>

<h3 id="extract-components">Extract Components</h3>

<p>If we return to React’s DevTools and turn “Highlight Updates” on again. The next thing you will notice is that the
component is re-rendered any time a Todo is added or removed as the value for the expression
<code class="highlighter-rouge">AppData.model.totalCount()</code> changes. Unfortunately <code class="highlighter-rouge">@Computed</code> will not help us here as the html output changes
every time a re-render occurs. However we can decide to limit the scope of the rendering by extracting a component
that encapsulates the html that changes.</p>

<div class="example">

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@ReactComponent</span>
<span class="kd">class</span> <span class="nc">FooterTodoCount</span>
  <span class="kd">extends</span> <span class="n">ReactArezComponent</span><span class="o">&lt;</span><span class="n">BaseProps</span><span class="o">,</span> <span class="n">BaseContext</span><span class="o">&gt;</span>
<span class="o">{</span>
  <span class="nd">@Nonnull</span>
  <span class="kd">static</span> <span class="n">ReactNode</span> <span class="nf">create</span><span class="o">()</span>
  <span class="o">{</span>
    <span class="k">return</span> <span class="nf">_create</span><span class="o">();</span>
  <span class="o">}</span>

  <span class="nd">@Nullable</span>
  <span class="nd">@Override</span>
  <span class="kd">protected</span> <span class="n">ReactNode</span> <span class="nf">render</span><span class="o">()</span>
  <span class="o">{</span>
    <span class="kd">final</span> <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="n">AppData</span><span class="o">.</span><span class="na">model</span><span class="o">.</span><span class="na">totalCount</span><span class="o">();</span>
    <span class="kd">final</span> <span class="n">String</span> <span class="n">activeTodoWord</span> <span class="o">=</span> <span class="s">"item"</span> <span class="o">+</span> <span class="o">(</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">?</span> <span class="s">""</span> <span class="o">:</span> <span class="s">"s"</span> <span class="o">);</span>
    <span class="k">return</span>
      <span class="nf">span</span><span class="o">(</span> <span class="k">new</span> <span class="n">HtmlProps</span><span class="o">().</span><span class="na">className</span><span class="o">(</span> <span class="s">"todo-count"</span> <span class="o">),</span>
            <span class="n">strong</span><span class="o">(</span> <span class="n">Integer</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span> <span class="n">count</span> <span class="o">)</span> <span class="o">),</span>
            <span class="n">text</span><span class="o">(</span> <span class="s">" "</span> <span class="o">+</span> <span class="n">activeTodoWord</span> <span class="o">+</span> <span class="s">" left"</span> <span class="o">)</span>
      <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

</div>

<p>This component can be rendered via an expression such as <code class="highlighter-rouge">React.createElement( FooterTodoCount_.TYPE )</code>.</p>

<p>The <code class="highlighter-rouge">FooterTodoCount</code> component will still be re-rendered every time a Todo is added or removed but the scope
of the re-render is much smaller and thus the amount of work that React4j has to do is much smaller.</p>

<p>We could also extract another component to manage the links and only re-render this new component when the
<code class="highlighter-rouge">filterMode</code> observable property changes but we have decided against this as it is a relatively infrequent event.
The final <code class="highlighter-rouge">Footer</code> component looks something like:</p>

<div class="example">

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@ReactComponent</span>
<span class="kd">class</span> <span class="nc">Footer</span>
  <span class="kd">extends</span> <span class="n">ReactArezComponent</span><span class="o">&lt;</span><span class="n">BaseProps</span><span class="o">,</span> <span class="n">BaseContext</span><span class="o">&gt;</span>
<span class="o">{</span>
  <span class="nd">@EventHandler</span><span class="o">(</span> <span class="n">MouseEventHandler</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
  <span class="kt">void</span> <span class="nf">handleClearCompleted</span><span class="o">()</span>
  <span class="o">{</span>
    <span class="n">AppData</span><span class="o">.</span><span class="na">service</span><span class="o">.</span><span class="na">clearCompleted</span><span class="o">();</span>
  <span class="o">}</span>

  <span class="nd">@Nullable</span>
  <span class="nd">@Override</span>
  <span class="kd">protected</span> <span class="n">ReactNode</span> <span class="nf">render</span><span class="o">()</span>
  <span class="o">{</span>
    <span class="kd">final</span> <span class="n">FilterMode</span> <span class="n">filterMode</span> <span class="o">=</span> <span class="n">AppData</span><span class="o">.</span><span class="na">viewService</span><span class="o">.</span><span class="na">getFilterMode</span><span class="o">();</span>
    <span class="k">return</span>
      <span class="nf">footer</span><span class="o">(</span> <span class="k">new</span> <span class="n">HtmlProps</span><span class="o">().</span><span class="na">className</span><span class="o">(</span> <span class="s">"footer"</span> <span class="o">),</span>
              <span class="n">FooterTodoCount</span><span class="o">.</span><span class="na">create</span><span class="o">(),</span>
              <span class="n">ul</span><span class="o">(</span> <span class="k">new</span> <span class="n">HtmlProps</span><span class="o">().</span><span class="na">className</span><span class="o">(</span> <span class="s">"filters"</span> <span class="o">),</span>
                  <span class="n">li</span><span class="o">(</span> <span class="n">a</span><span class="o">(</span> <span class="k">new</span> <span class="n">AnchorProps</span><span class="o">()</span>
                           <span class="o">.</span><span class="na">className</span><span class="o">(</span> <span class="n">FilterMode</span><span class="o">.</span><span class="na">ALL</span> <span class="o">==</span> <span class="n">filterMode</span> <span class="o">?</span> <span class="s">"selected"</span> <span class="o">:</span> <span class="s">""</span> <span class="o">)</span>
                           <span class="o">.</span><span class="na">href</span><span class="o">(</span> <span class="s">"#"</span> <span class="o">),</span> <span class="s">"All"</span> <span class="o">)</span>
                  <span class="o">),</span>
                  <span class="n">li</span><span class="o">(</span> <span class="n">a</span><span class="o">(</span> <span class="k">new</span> <span class="n">AnchorProps</span><span class="o">()</span>
                           <span class="o">.</span><span class="na">className</span><span class="o">(</span> <span class="n">FilterMode</span><span class="o">.</span><span class="na">ACTIVE</span> <span class="o">==</span> <span class="n">filterMode</span> <span class="o">?</span> <span class="s">"selected"</span> <span class="o">:</span> <span class="s">""</span> <span class="o">)</span>
                           <span class="o">.</span><span class="na">href</span><span class="o">(</span> <span class="s">"#active"</span> <span class="o">),</span> <span class="s">"Active"</span> <span class="o">)</span>
                  <span class="o">),</span>
                  <span class="n">li</span><span class="o">(</span> <span class="n">a</span><span class="o">(</span> <span class="k">new</span> <span class="n">AnchorProps</span><span class="o">()</span>
                           <span class="o">.</span><span class="na">className</span><span class="o">(</span> <span class="n">FilterMode</span><span class="o">.</span><span class="na">COMPLETED</span> <span class="o">==</span> <span class="n">filterMode</span> <span class="o">?</span> <span class="s">"selected"</span> <span class="o">:</span> <span class="s">""</span> <span class="o">)</span>
                           <span class="o">.</span><span class="na">href</span><span class="o">(</span> <span class="s">"#completed"</span> <span class="o">),</span> <span class="s">"Completed"</span> <span class="o">)</span>
                  <span class="o">)</span>
              <span class="o">),</span>
              <span class="n">hasCompletedItems</span><span class="o">()</span> <span class="o">?</span>
              <span class="n">button</span><span class="o">(</span> <span class="k">new</span> <span class="n">BtnProps</span><span class="o">().</span><span class="na">className</span><span class="o">(</span> <span class="s">"clear-completed"</span> <span class="o">).</span><span class="na">onClick</span><span class="o">(</span> <span class="n">_handleClearCompleted</span><span class="o">(</span> <span class="k">this</span> <span class="o">)</span> <span class="o">),</span>
                      <span class="s">"Clear Completed"</span> <span class="o">)</span> <span class="o">:</span>
              <span class="kc">null</span>
      <span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@Computed</span>
  <span class="kt">boolean</span> <span class="nf">hasCompletedItems</span><span class="o">()</span>
  <span class="o">{</span>
    <span class="k">return</span> <span class="n">AppData</span><span class="o">.</span><span class="na">model</span><span class="o">.</span><span class="na">completedCount</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

</div>

<h3 id="on-optimizing">On Optimizing</h3>

<p>Ultimately measuring performance and optimizing when needed to keep within your performance budget is the ideal
goal. It is important to know which parts of your application need to be fast and which parts are
less important to optimize. In some cases, the application is small enough to never need optimization while
in others optimizing components by default may be a good option (i.e. if the cost of optimization is lower
than the cost of determining which parts of the application to optimize).</p>

<h2 id="best-practices">Best Practices</h2>

<p>Arez and React4j is such a powerful combination that many of the best practices that you use when building a
React4j application no longer make sense after you integrate Arez. However this section will try to give some
helpful suggestions that simplify your development experience. You should also checkout the Arez
<a href="/faq#arez-integration">FAQ Section</a>.</p>

<h3 id="ui-state-should-be-modelled-with-arez-observable-state">UI state should be modelled with Arez Observable State</h3>

<p>Often applications start by just modelling the application domain classes as observable state. So an application
has observable entities to model <code class="highlighter-rouge">Employee</code>, <code class="highlighter-rouge">Sale</code>, <code class="highlighter-rouge">Customer</code> etc. However it is extremely useful to model user
interface state such as which tab is visible, the current application place or route, whether a button is visible
etc. using observable state. This provides a single, unified mechanism for reacting to changes and updating the user
interface.</p>

<p>In an ideal world, we should be able to persist the arez observable state, relaunch the web page and load the
observable state and the application should appear just as it was before the relaunch.</p>

<p>The question often arises, when should you use React4j component level state. In most cases this state is no
longer necessary however it sometimes makes sense to use it if:</p>

<ul>
  <li>The component would otherwise be a generic component and need not extend <code class="highlighter-rouge">ReactArezComponent</code>.</li>
  <li>The state never needs to be shared with any other component.</li>
</ul>

<h3 id="avoid-writing-business-logic-in-your-react4j-components">Avoid writing “business logic” in your React4j components</h3>

<p>In an ideal world your Arez/React4j application, React4j should just be providing the view and Arez should
provide the business logic. The business logic method in the Arez components are then called from React4j
components. This makes it much easier to reuse, refactor and test the business logic. In most cases
the business logic can be tested outside the browser in pure java. Another advantage is that it makes the
application much easier to understand.</p>

<h3 id="separate-network-interactions-from-react4j-components-and-other-arez-business-logic-components">Separate network interactions from React4j components and other arez business logic components</h3>

<p>Network interactions can be notoriously difficult to test. They are business logic and should not be put in
your React4j components and instead should be triggered from arez components.</p>

<p>One approach is to extract the service API calls behind an interface and pass the service interface into the
constructor of the arez component. This way the unit tests can pass in a mock API service during testing.</p>

<p>Consider the example where you have an action that wants to transition to a view listing employees and wants
to load all the employee data for the view. A typical example using the “extract a remote service interface”
strategy would be:</p>

<div class="example">

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@ArezComponent</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">EmployeeService</span>
<span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">RemoteServiceAPI</span> <span class="n">_remote</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">_loading</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">_employeeData</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">_errorMessage</span><span class="o">;</span>

  <span class="kd">public</span> <span class="nf">EmployeeService</span><span class="o">(</span> <span class="kd">final</span> <span class="n">RemoteServiceAPI</span> <span class="n">remote</span> <span class="o">)</span>
  <span class="o">{</span>
    <span class="n">_remote</span> <span class="o">=</span> <span class="n">remote</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@Action</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">changeToEmployeeView</span><span class="o">()</span>
  <span class="o">{</span>
    <span class="n">setLoading</span><span class="o">(</span> <span class="kc">true</span> <span class="o">);</span>
    <span class="n">_remote</span><span class="o">.</span><span class="na">loadEmployeeData</span><span class="o">(</span> <span class="n">data</span> <span class="o">-&gt;</span> <span class="o">{</span>
      <span class="n">setLoading</span><span class="o">(</span> <span class="kc">false</span> <span class="o">);</span>
      <span class="n">setEmployeeData</span><span class="o">(</span> <span class="n">data</span> <span class="o">);</span>
    <span class="o">},</span> <span class="n">errorMessage</span> <span class="o">-&gt;</span> <span class="o">{</span>
      <span class="n">setLoading</span><span class="o">(</span> <span class="kc">false</span> <span class="o">);</span>
      <span class="n">setErrorMessage</span><span class="o">(</span> <span class="n">errorMessage</span> <span class="o">);</span>
    <span class="o">}</span> <span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@Observable</span>
  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isLoading</span><span class="o">()</span>
  <span class="o">{</span>
    <span class="k">return</span> <span class="n">_loading</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setLoading</span><span class="o">(</span> <span class="kd">final</span> <span class="kt">boolean</span> <span class="n">loading</span> <span class="o">)</span>
  <span class="o">{</span>
    <span class="n">_loading</span> <span class="o">=</span> <span class="n">loading</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@Observable</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getEmployeeData</span><span class="o">()</span>
  <span class="o">{</span>
    <span class="k">return</span> <span class="n">_employeeData</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setEmployeeData</span><span class="o">(</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">employeeData</span> <span class="o">)</span>
  <span class="o">{</span>
    <span class="n">_employeeData</span> <span class="o">=</span> <span class="n">employeeData</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@Observable</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getErrorMessage</span><span class="o">()</span>
  <span class="o">{</span>
    <span class="k">return</span> <span class="n">_errorMessage</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setErrorMessage</span><span class="o">(</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">errorMessage</span> <span class="o">)</span>
  <span class="o">{</span>
    <span class="n">_errorMessage</span> <span class="o">=</span> <span class="n">errorMessage</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

</div>

<p>Another approach that is even easier to test and arguably easier to understand is to have the the <code class="highlighter-rouge">@Action</code>
annotated method set state the defines the “intent” to perform a remote service and then have a separate arez
component that uses an <code class="highlighter-rouge">@Autorun</code> method that observes the “intent” and performs remote call when the intent
indicates that it is required.</p>

<p>So this results in some minor modifications to the employee service so that the action is implemented as follows:</p>

<div class="example">

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">private</span> <span class="kt">boolean</span> <span class="n">_loadEmployeeData</span><span class="o">;</span>

<span class="nd">@Observable</span><span class="o">(</span> <span class="n">name</span> <span class="o">=</span> <span class="s">"loadEmployeeData"</span> <span class="o">)</span>
<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">shouldLoadEmployeeData</span><span class="o">()</span>
<span class="o">{</span>
  <span class="k">return</span> <span class="n">_loadEmployeeData</span><span class="o">;</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setLoadEmployeeData</span><span class="o">(</span> <span class="kd">final</span> <span class="kt">boolean</span> <span class="n">loadEmployeeData</span> <span class="o">)</span>
<span class="o">{</span>
  <span class="n">_loadEmployeeData</span> <span class="o">=</span> <span class="n">loadEmployeeData</span><span class="o">;</span>
<span class="o">}</span>

<span class="nd">@Action</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">changeToEmployeeView</span><span class="o">()</span>
<span class="o">{</span>
  <span class="n">setLoadEmployeeData</span><span class="o">(</span> <span class="kc">true</span> <span class="o">);</span>
<span class="o">}</span></code></pre></figure>

</div>

<p>Then there would be a separate arez component to observe the intent and perform the remote call:</p>

<div class="example">

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@ArezComponent</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">EmployeeDataLoader</span>
<span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">RemoteServiceAPI</span> <span class="n">_remote</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">EmployeeService</span> <span class="n">_service</span><span class="o">;</span>

  <span class="kd">public</span> <span class="nf">EmployeeDataLoader</span><span class="o">(</span> <span class="kd">final</span> <span class="n">RemoteServiceAPI</span> <span class="n">remote</span><span class="o">,</span> <span class="kd">final</span> <span class="n">EmployeeService</span> <span class="n">service</span> <span class="o">)</span>
  <span class="o">{</span>
    <span class="n">_remote</span> <span class="o">=</span> <span class="n">remote</span><span class="o">;</span>
    <span class="n">_service</span> <span class="o">=</span> <span class="n">service</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@Autorun</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">loadEmployeeDataIfRequired</span><span class="o">()</span>
  <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span> <span class="n">_service</span><span class="o">.</span><span class="na">shouldLoadEmployeeData</span><span class="o">()</span> <span class="o">)</span>
    <span class="o">{</span>
      <span class="n">_service</span><span class="o">.</span><span class="na">setLoading</span><span class="o">(</span> <span class="kc">true</span> <span class="o">);</span>
      <span class="n">_remote</span><span class="o">.</span><span class="na">loadEmployeeData</span><span class="o">(</span> <span class="n">data</span> <span class="o">-&gt;</span> <span class="o">{</span>
        <span class="n">_service</span><span class="o">.</span><span class="na">setLoading</span><span class="o">(</span> <span class="kc">false</span> <span class="o">);</span>
        <span class="n">_service</span><span class="o">.</span><span class="na">setEmployeeData</span><span class="o">(</span> <span class="n">data</span> <span class="o">);</span>
        <span class="n">_service</span><span class="o">.</span><span class="na">setLoadEmployeeData</span><span class="o">(</span> <span class="kc">false</span> <span class="o">);</span>
      <span class="o">},</span> <span class="n">errorMessage</span> <span class="o">-&gt;</span> <span class="o">{</span>
        <span class="n">_service</span><span class="o">.</span><span class="na">setLoading</span><span class="o">(</span> <span class="kc">false</span> <span class="o">);</span>
        <span class="n">_service</span><span class="o">.</span><span class="na">setErrorMessage</span><span class="o">(</span> <span class="n">errorMessage</span> <span class="o">);</span>
        <span class="n">_service</span><span class="o">.</span><span class="na">setLoadEmployeeData</span><span class="o">(</span> <span class="kc">false</span> <span class="o">);</span>
      <span class="o">}</span> <span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

</div>

<p>This approach where you separate intent and have another component that performs the remote call means that
your unit tests are much more focused and simpler to understand. It has the disadvantage that it requires more
verbose code constructs and can result in more abstraction and indirection. In a small application with a single
developer this can have a negative effect. Larger applications with larger teams may benefit from the higher
level of abstraction.</p>

<h3 id="avoid-arez-annotations-other-than-computed-and-action-in-react4j-components">Avoid arez annotations other than @Computed and @Action in React4j components</h3>

<p>Following the above best practices, you will find you rarely if ever need to annotate any methods in a
<code class="highlighter-rouge">ReactArezComponent</code> subclass with any Arez annotations other than <code class="highlighter-rouge">@Computed</code> and <code class="highlighter-rouge">@Action</code> and as most
uses of <code class="highlighter-rouge">@Action</code> are in <code class="highlighter-rouge">@EventHandler</code> annotated methods that default to being annotated with an <code class="highlighter-rouge">@Action</code>
you may find that is rarely a good use case for using <code class="highlighter-rouge">@Action</code> in your react components.</p>

			</article>
		</section>

		<script>
			document.getElementById("open-nav").addEventListener("click", function () {
				document.body.classList.toggle("nav-open");
			});
		</script>
	</body>
</html>
